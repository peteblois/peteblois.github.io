<!DOCTYPE html>
<meta charset="utf-8">

<h1>Isolated iframe process</h1>
Repro steps:
<ol>
  <li>Load this page âœ”.</li>
  <li>Open Chrome's task manager, sort by CPU</li>
  <li>Observe 'Subframe: https://googleusercontent.com/' at the top, get the process ID</li>
  <li>Close the tab</li>
  <li>Observe process disappears from taskmanager</li>
  <li>Run 'top'- observe the process is still there, consuming 100% CPU</li>
</ol>

<script>
  function getOrigin() {
    const array = new Uint32Array(1);
    window.crypto.getRandomValues(array);
    const float = array[0] / (1 << 16) / (1 << 16);
    return float.toString(36).substr(2);
  }

  async function main() {
    const origin = getOrigin();
    const iframe = document.createElement('iframe');
    iframe.src = `https://${origin}-colab.googleusercontent.com/v2/usercontent/b645cdf6ae3e8b14/outputframe.html?vrz=1`;

    await new Promise((resolve, reject) => {
      iframe.onload = resolve;
      iframe.onerror = reject;
      document.body.appendChild(iframe);
    });

    document.body.appendChild(document.createTextNode('Created iframe!'));

    const iframeSource = new URL('iframe.js', window.location);

    iframe.contentWindow.postMessage({
      'sandboxed_iframe_evaluation': `
        while(true) {}
      `,
    }, '*');
  }

  main();
</script>
